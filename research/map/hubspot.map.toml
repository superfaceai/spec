# Profile Id
profile = 'http://supermodel.io/superface/CRM/Customers'

# Curies
[curies.stream]
profile = 'http://supermodel.io/superface/superdriver/Stream'

# Provider for this map
[provider]
id = 'http://superface.ai/directory/hubspot'

# Mapping
[map.RetrieveCustomers.http]
method = 'GET'
href = '/companies/v2/companies/paged'

  # Query parameters
  [map.RetrieveCustomers.http.query]
  offset = 'stream:offset' # -> http://supermodel.io/superface/superdriver/Stream#/descriptors/offset
  limit = 'stream:limit'
  properties = [':name', ':website']

  [map.RetrieveCustomers.http.query.hapikey]
  source = '$security.apikey'

  # Response
  [map.RetrieveCustomers.http.response.200.'application/json'.body]
  'customers[].id' = '.companies[].companyId'
  'customers[].name' = '.companies[].properties.name.value'
  'customers[].website' = '.companies[].properties.website.value'
  
  
  'customerCount' = '${ body.companies.length() }'

  [map.RetrieveCustomers.result]
  context = "http.response.200.'application/json'.body"


  # 'customerCount' = '.companies | length'

  'customers' = '''${
    return map(body.companies, (company) => {
      return {
        id = company.companyId
        name = company.properties.name.value
        website = company.properties.website.value
      }
    }
  }'''
  
  # Streaming
  'stream:offset' = '.offset'
  'stream:hasMore' = '.has-more'
