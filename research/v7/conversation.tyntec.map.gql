profile = "http://superface.ai/profile/conversation/SendMessage"
provider = "http://superface.ai/directory/Tyntec#SMS"

# Tyntec API documentation available at:
#   https://api.tyntec.com/reference/#conversations-send-messages-send-a-message

map SendMessage {
  
  http POST "https://api.tyntec.com/chat-api/v2/messages" {
    request "application/json" {
      body {
        to = input.to
        channels = ['sms']
        sms.from = input.from
        sms.contentType = 'text'
        sms.text = input.text
        
        # JUST for testing syntax
        someObject = {
          a: 4
          b: 2
        }
      }
    }

    response 200 "application/json" {
      messageId = body.messageId
      bazmek = body.bazmekCoPriselPresHTTP
    }
  }

  run OpravBazmek { args { bazmekKOprave = bazmek }

    result {
      uzNeBazmek = return.oxxxx
      messageId = messageId
    }
  }

}

map RetrieveMessageStatus {
  messageId = input.messageId

  http GET "https://api.tyntec.com/chat-api/v2/messages/{messageId}/history" {
    response 200 "application/json" {
      result {
        deliveryStatus = body.history[0].state
      }
    }
  } 
}
