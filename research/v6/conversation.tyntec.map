profile = "http://superface.ai/profile/conversation/SendMessage"
provider = "http://superface.ai/directory/Tyntec#SMS"

# Tyntec API documentation available at:
#   https://api.tyntec.com/reference/#conversations-send-messages-send-a-message

map SendMessage {
  http POST "https://api.tyntec.com/chat-api/v2/messages" {
    request "application/json" {
      body {
        to = input.to
        channels = ['sms']
        sms.from = input.from
        sms.contentType = 'text'
        sms.text = input.text

        # Testing stuff
        someObject = {
          a: 4
          b: 2
        }
      }
    }

    response 200 "application/json" {
      result {
        messageId = body.messageId
      }
    }
  }
}

map RetrieveMessageStatus {
  http GET https://api.tyntec.com/chat-api/v2/messages/{messageId}/history {
    set {
      messageId = input.messageId
    }

    response 200 application/json {
      result {
        deliveryStatus = body.history[0].state
      }
    }
  }
}
